package numberplace;

public class Field {

	Square board[][] = new Square[9][9];

	Field() {
		for (byte i = 0; i < 9; i++) {
			for (byte j = 0; j < 9; j++) {
				board[i][j] = new Square();
			}
		}
	}

	// display board
	public void dispBoard() {
		/*
		 * for (Square array[] : board) { for (Square square : array) {
		 * System.out.print(square.number); }
		 */
		for (byte i = 0; i < 9; i++) {
			for (byte j = 0; j < 9; j++) {
				System.out.print(board[i][j].number);
			}
			System.out.print("\n");
		}
		System.out.println("\n");
	}

	public void writeNum(byte num, byte x, byte y) {
		board[x][y].number = num;
	}

	// search horizontal(x is const)
	public void searchHorizontal(byte x, byte y) {
		for (byte i = 0; i < 9; i++) {
			if (board[x][i].number != 0) {// number is written(not 0)
				board[x][y].possibleNum.put(board[x][i].number, false);// if number is written, true -> false
			}
		}
	}

	// search vertical(y is const)
	public void searchVertical(byte x, byte y) {
		for (byte i = 0; i < 9; i++) {
			if (board[i][y].number != 0) {// number is written(not 0)
				board[x][y].possibleNum.put(board[i][y].number, false);// if number is written, true -> false
			}
		}
	}

	// search block(3*3)
	public void searchBlock(byte x, byte y) {
		// (xtop,ytop) is left upper coordinate
		byte xtop = (byte) ((x / (byte) 3) * (byte) 3);
		byte ytop = (byte) ((y / (byte) 3) * (byte) 3);

		for (byte i = 0; i < 3; i++) {
			for (byte j = 0; j < 3; j++) {
				if (board[xtop + i][ytop + j].number != 0) {
					board[x][y].possibleNum.put(board[xtop + i][ytop + j].number, false);
				}
			}
		}
	}

	public void solve() {
		byte i, j;
		boolean flag;
		while (true) {
			flag = true;
			for (i = 0; i < 9; i++) {
				for (j = 0; j < 9; j++) {
					if (board[i][j].number == 0) {
						searchHorizontal(i, j);
						searchVertical(i, j);
						searchBlock(i, j);
						if (board[i][j].solveNumber() != 0) {// number is decided
							board[i][j].number = board[i][j].solveNumber();// fixed number is written
							flag = false;// new number is written
							System.out.println("("+i+","+j+")"+" "+board[i][j].number);
							dispBoard();
						}
					}
				}
			}
			if (flag) {// if no number is written finish loop
				System.out.println("finish");
				break;
			}
		}
	}

	public static void main(String args[]) {
		Field test = new Field();

		test.writeNum((byte)2,(byte)0,(byte)0);
		test.writeNum((byte)7,(byte)0,(byte)1);
		test.writeNum((byte)1,(byte)0,(byte)7);
		test.writeNum((byte)6,(byte)0,(byte)8);
		
		test.writeNum((byte)3,(byte)1,(byte)0);
		test.writeNum((byte)5,(byte)1,(byte)3);
		test.writeNum((byte)7,(byte)1,(byte)4);
		test.writeNum((byte)4,(byte)1,(byte)5);
		test.writeNum((byte)8,(byte)1,(byte)8);
		
		test.writeNum((byte)2,(byte)2,(byte)5);
		
		test.writeNum((byte)6,(byte)3,(byte)1);
		test.writeNum((byte)3,(byte)3,(byte)2);
		test.writeNum((byte)7,(byte)3,(byte)3);
		test.writeNum((byte)5,(byte)3,(byte)5);
		test.writeNum((byte)2,(byte)3,(byte)7);
		
		test.writeNum((byte)5,(byte)4,(byte)1);
		test.writeNum((byte)6,(byte)4,(byte)7);
		
		test.writeNum((byte)8,(byte)5,(byte)1);
		test.writeNum((byte)2,(byte)5,(byte)3);
		test.writeNum((byte)3,(byte)5,(byte)5);
		test.writeNum((byte)4,(byte)5,(byte)6);
		test.writeNum((byte)5,(byte)5,(byte)7);
		
		test.writeNum((byte)1,(byte)6,(byte)3);
		
		test.writeNum((byte)6,(byte)7,(byte)0);
		test.writeNum((byte)3,(byte)7,(byte)3);
		test.writeNum((byte)4,(byte)7,(byte)4);
		test.writeNum((byte)8,(byte)7,(byte)5);
		test.writeNum((byte)1,(byte)7,(byte)8);
		
		test.writeNum((byte)1,(byte)8,(byte)0);
		test.writeNum((byte)4,(byte)8,(byte)1);
		test.writeNum((byte)8,(byte)8,(byte)7);
		test.writeNum((byte)5,(byte)8,(byte)8);
		
		test.dispBoard();
		
		test.solve();
	}
}